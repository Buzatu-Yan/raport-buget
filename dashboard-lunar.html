<!DOCTYPE html>
<html lang="ro">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Dashboard Financiar Lunar</title>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf-autotable/3.8.2/jspdf.plugin.autotable.min.js"></script>
<style>
  @import url('https://fonts.googleapis.com/css2?family=DM+Serif+Display:ital@0;1&family=DM+Mono:wght@300;400;500&display=swap');

  :root {
    --bg: #0e0e11;
    --surface: #16161c;
    --surface2: #1e1e27;
    --border: #2a2a38;
    --accent-green: #4ade80;
    --accent-red: #f87171;
    --accent-yellow: #fbbf24;
    --accent-blue: #60a5fa;
    --text: #e8e8f0;
    --text-muted: #7070a0;
    --text-dim: #404060;
  }

  * { margin: 0; padding: 0; box-sizing: border-box; }

  body {
    background: var(--bg);
    color: var(--text);
    font-family: 'DM Mono', monospace;
    min-height: 100vh;
    padding: 2rem;
  }

  header {
    display: flex;
    align-items: center;
    justify-content: space-between;
    margin-bottom: 2.5rem;
    padding-bottom: 1.5rem;
    border-bottom: 1px solid var(--border);
  }

  .logo {
    font-family: 'DM Serif Display', serif;
    font-size: 1.8rem;
    color: var(--text);
    letter-spacing: -0.02em;
  }
  .logo span { color: var(--accent-yellow); }

  .month-nav {
    display: flex;
    align-items: center;
    gap: 1rem;
  }

  .month-nav button {
    background: var(--surface);
    border: 1px solid var(--border);
    color: var(--text-muted);
    width: 36px; height: 36px;
    border-radius: 8px;
    cursor: pointer;
    font-size: 1.1rem;
    transition: all 0.2s;
  }
  .month-nav button:hover { border-color: var(--accent-yellow); color: var(--accent-yellow); }

  #current-month-label {
    font-size: 1rem;
    color: var(--text);
    min-width: 160px;
    text-align: center;
    letter-spacing: 0.05em;
    text-transform: uppercase;
  }

  .btn-pdf {
    display: flex;
    align-items: center;
    gap: 0.5rem;
    background: var(--accent-yellow);
    color: #111;
    border: none;
    padding: 0.6rem 1.4rem;
    border-radius: 8px;
    cursor: pointer;
    font-family: 'DM Mono', monospace;
    font-weight: 500;
    font-size: 0.85rem;
    transition: all 0.2s;
    letter-spacing: 0.03em;
  }
  .btn-pdf:hover { background: #f59e0b; transform: translateY(-1px); box-shadow: 0 4px 20px rgba(251,191,36,0.3); }

  .summary-grid {
    display: grid;
    grid-template-columns: repeat(3, 1fr);
    gap: 1rem;
    margin-bottom: 2rem;
  }

  .card {
    background: var(--surface);
    border: 1px solid var(--border);
    border-radius: 12px;
    padding: 1.4rem;
    transition: border-color 0.2s;
  }
  .card:hover { border-color: var(--border); }

  .card-label {
    font-size: 0.7rem;
    color: var(--text-muted);
    text-transform: uppercase;
    letter-spacing: 0.12em;
    margin-bottom: 0.6rem;
  }

  .card-value {
    font-family: 'DM Serif Display', serif;
    font-size: 2rem;
    letter-spacing: -0.02em;
  }

  .card-value.income { color: var(--accent-green); }
  .card-value.expense { color: var(--accent-red); }
  .card-value.balance { color: var(--accent-yellow); }
  .card-value.balance.negative { color: var(--accent-red); }

  .card-sub {
    font-size: 0.72rem;
    color: var(--text-dim);
    margin-top: 0.3rem;
  }

  .main-layout {
    display: grid;
    grid-template-columns: 1fr 1fr;
    gap: 1.5rem;
  }

  .section-title {
    font-size: 0.7rem;
    text-transform: uppercase;
    letter-spacing: 0.12em;
    color: var(--text-muted);
    margin-bottom: 1rem;
    display: flex;
    align-items: center;
    justify-content: space-between;
  }

  .btn-add {
    background: var(--surface2);
    border: 1px solid var(--border);
    color: var(--text-muted);
    padding: 0.2rem 0.7rem;
    border-radius: 5px;
    cursor: pointer;
    font-family: 'DM Mono', monospace;
    font-size: 0.7rem;
    transition: all 0.2s;
  }
  .btn-add:hover { border-color: var(--accent-green); color: var(--accent-green); }
  .btn-add.red:hover { border-color: var(--accent-red); color: var(--accent-red); }

  .list-container {
    background: var(--surface);
    border: 1px solid var(--border);
    border-radius: 12px;
    padding: 1.2rem;
  }

  .entry-row {
    display: flex;
    align-items: center;
    justify-content: space-between;
    padding: 0.6rem 0;
    border-bottom: 1px solid var(--border);
    gap: 0.5rem;
    animation: fadeIn 0.3s ease;
  }
  @keyframes fadeIn { from { opacity: 0; transform: translateY(-5px); } to { opacity: 1; transform: none; } }

  .entry-row:last-child { border-bottom: none; }

  .entry-row input[type="text"] {
    flex: 1;
    background: transparent;
    border: none;
    color: var(--text);
    font-family: 'DM Mono', monospace;
    font-size: 0.82rem;
    outline: none;
    min-width: 0;
  }

  .entry-row input[type="number"] {
    width: 100px;
    background: var(--surface2);
    border: 1px solid var(--border);
    border-radius: 5px;
    color: var(--text);
    font-family: 'DM Mono', monospace;
    font-size: 0.82rem;
    padding: 0.2rem 0.5rem;
    outline: none;
    text-align: right;
  }
  .entry-row input[type="number"]:focus { border-color: var(--accent-yellow); }

  .entry-row select {
    background: var(--surface2);
    border: 1px solid var(--border);
    border-radius: 5px;
    color: var(--text-muted);
    font-family: 'DM Mono', monospace;
    font-size: 0.72rem;
    padding: 0.2rem 0.4rem;
    outline: none;
    cursor: pointer;
  }

  .entry-amount {
    font-weight: 500;
    min-width: 80px;
    text-align: right;
    font-size: 0.85rem;
  }
  .income-amount { color: var(--accent-green); }
  .expense-amount { color: var(--accent-red); }

  .btn-del {
    background: none;
    border: none;
    color: var(--text-dim);
    cursor: pointer;
    font-size: 0.8rem;
    padding: 0.2rem;
    transition: color 0.2s;
    flex-shrink: 0;
  }
  .btn-del:hover { color: var(--accent-red); }

  .tag {
    font-size: 0.65rem;
    padding: 0.1rem 0.4rem;
    border-radius: 3px;
    background: var(--surface2);
    color: var(--text-dim);
    white-space: nowrap;
    flex-shrink: 0;
  }

  .chart-section {
    margin-top: 1.5rem;
    grid-column: span 2;
  }

  .chart-bar-area {
    background: var(--surface);
    border: 1px solid var(--border);
    border-radius: 12px;
    padding: 1.4rem;
  }

  .bars-wrap {
    display: flex;
    align-items: flex-end;
    gap: 0.6rem;
    height: 120px;
    margin-top: 1rem;
  }

  .bar-group {
    flex: 1;
    display: flex;
    flex-direction: column;
    align-items: center;
    gap: 3px;
    height: 100%;
    justify-content: flex-end;
  }

  .bar-income, .bar-expense {
    width: 100%;
    border-radius: 4px 4px 0 0;
    transition: height 0.5s ease;
    min-height: 2px;
    position: relative;
  }
  .bar-income { background: var(--accent-green); opacity: 0.8; }
  .bar-expense { background: var(--accent-red); opacity: 0.8; }

  .bar-month-label {
    font-size: 0.6rem;
    color: var(--text-dim);
    margin-top: 4px;
    text-transform: uppercase;
    letter-spacing: 0.08em;
  }

  .bar-pair {
    display: flex;
    gap: 2px;
    align-items: flex-end;
    height: 100%;
    width: 100%;
  }

  .bar-pair > div { width: 50%; }

  /* Modal */
  .modal-overlay {
    display: none;
    position: fixed;
    inset: 0;
    background: rgba(0,0,0,0.7);
    z-index: 100;
    align-items: center;
    justify-content: center;
  }
  .modal-overlay.open { display: flex; }

  .modal {
    background: var(--surface);
    border: 1px solid var(--border);
    border-radius: 14px;
    padding: 2rem;
    min-width: 340px;
    max-width: 90vw;
  }

  .modal h3 {
    font-family: 'DM Serif Display', serif;
    font-size: 1.3rem;
    margin-bottom: 1.2rem;
  }

  .modal .field {
    margin-bottom: 0.8rem;
  }

  .modal label {
    display: block;
    font-size: 0.7rem;
    color: var(--text-muted);
    text-transform: uppercase;
    letter-spacing: 0.1em;
    margin-bottom: 0.3rem;
  }

  .modal input, .modal select {
    width: 100%;
    background: var(--surface2);
    border: 1px solid var(--border);
    border-radius: 7px;
    color: var(--text);
    font-family: 'DM Mono', monospace;
    font-size: 0.85rem;
    padding: 0.5rem 0.8rem;
    outline: none;
  }
  .modal input:focus, .modal select:focus { border-color: var(--accent-yellow); }

  .modal-actions {
    display: flex;
    gap: 0.8rem;
    margin-top: 1.2rem;
  }

  .btn-confirm {
    flex: 1;
    background: var(--accent-yellow);
    color: #111;
    border: none;
    padding: 0.6rem;
    border-radius: 7px;
    font-family: 'DM Mono', monospace;
    font-weight: 500;
    cursor: pointer;
    transition: background 0.2s;
  }
  .btn-confirm:hover { background: #f59e0b; }

  .btn-cancel {
    flex: 1;
    background: var(--surface2);
    color: var(--text-muted);
    border: 1px solid var(--border);
    padding: 0.6rem;
    border-radius: 7px;
    font-family: 'DM Mono', monospace;
    cursor: pointer;
  }
  .btn-cancel:hover { border-color: var(--accent-red); color: var(--accent-red); }

  .empty-state {
    text-align: center;
    padding: 1.5rem;
    color: var(--text-dim);
    font-size: 0.78rem;
  }

  @media (max-width: 768px) {
    body { padding: 1rem; }
    .summary-grid { grid-template-columns: 1fr; }
    .main-layout { grid-template-columns: 1fr; }
    .chart-section { grid-column: span 1; }
    header { flex-wrap: wrap; gap: 1rem; }
  }
</style>
</head>
<body>

<header>
  <div class="logo">fin<span>.</span>track</div>
  <div class="month-nav">
    <button id="prev-month">&#8592;</button>
    <span id="current-month-label"></span>
    <button id="next-month">&#8594;</button>
  </div>
  <button class="btn-pdf" onclick="generatePDF()">
    &#8595; Descarcă PDF
  </button>
</header>

<div class="summary-grid">
  <div class="card">
    <div class="card-label">Total Venituri</div>
    <div class="card-value income" id="total-income">0 RON</div>
    <div class="card-sub" id="income-count">0 înregistrări</div>
  </div>
  <div class="card">
    <div class="card-label">Total Cheltuieli</div>
    <div class="card-value expense" id="total-expense">0 RON</div>
    <div class="card-sub" id="expense-count">0 înregistrări</div>
  </div>
  <div class="card">
    <div class="card-label">Balanță Lunară</div>
    <div class="card-value balance" id="total-balance">0 RON</div>
    <div class="card-sub" id="balance-status">—</div>
  </div>
</div>

<div class="main-layout">
  <div>
    <div class="section-title">
      Venituri
      <button class="btn-add" onclick="openModal('income')">+ Adaugă</button>
    </div>
    <div class="list-container" id="income-list">
      <div class="empty-state">Nicio înregistrare. Apasă + Adaugă.</div>
    </div>
  </div>

  <div>
    <div class="section-title">
      Cheltuieli
      <button class="btn-add red" onclick="openModal('expense')">+ Adaugă</button>
    </div>
    <div class="list-container" id="expense-list">
      <div class="empty-state">Nicio înregistrare. Apasă + Adaugă.</div>
    </div>
  </div>

  <div class="chart-section">
    <div class="chart-bar-area">
      <div class="section-title">Evoluție 6 Luni</div>
      <div class="bars-wrap" id="bars-wrap"></div>
      <div style="display:flex;gap:1rem;margin-top:0.8rem;font-size:0.65rem;color:var(--text-dim)">
        <span style="display:flex;align-items:center;gap:4px"><span style="width:10px;height:10px;background:var(--accent-green);border-radius:2px;display:inline-block;"></span> Venituri</span>
        <span style="display:flex;align-items:center;gap:4px"><span style="width:10px;height:10px;background:var(--accent-red);border-radius:2px;display:inline-block;"></span> Cheltuieli</span>
      </div>
    </div>
  </div>
</div>

<!-- Modal -->
<div class="modal-overlay" id="modal-overlay">
  <div class="modal">
    <h3 id="modal-title">Adaugă Venit</h3>
    <div class="field">
      <label>Descriere</label>
      <input type="text" id="modal-desc" placeholder="ex: Salariu, Freelance...">
    </div>
    <div class="field">
      <label>Sumă (RON)</label>
      <input type="number" id="modal-amount" placeholder="0.00" min="0" step="0.01">
    </div>
    <div class="field">
      <label>Categorie</label>
      <select id="modal-category">
        <option value="Salariu">Salariu</option>
        <option value="Freelance">Freelance</option>
        <option value="Investiții">Investiții</option>
        <option value="Altele">Altele</option>
        <option value="Mâncare">Mâncare</option>
        <option value="Transport">Transport</option>
        <option value="Utilități">Utilități</option>
        <option value="Sănătate">Sănătate</option>
        <option value="Divertisment">Divertisment</option>
        <option value="Îmbrăcăminte">Îmbrăcăminte</option>
        <option value="Chirie">Chirie</option>
      </select>
    </div>
    <div class="modal-actions">
      <button class="btn-cancel" onclick="closeModal()">Anulează</button>
      <button class="btn-confirm" onclick="addEntry()">Salvează</button>
    </div>
  </div>
</div>

<script>
const MONTHS_RO = ['Ianuarie','Februarie','Martie','Aprilie','Mai','Iunie','Iulie','August','Septembrie','Octombrie','Noiembrie','Decembrie'];
let currentDate = new Date();
let currentYear = currentDate.getFullYear();
let currentMonth = currentDate.getMonth();
let modalType = 'income';

// Data: { "YYYY-MM": { income: [...], expense: [...] } }
let data = JSON.parse(localStorage.getItem('fintrack_data') || '{}');

function getKey(y, m) { return `${y}-${String(m+1).padStart(2,'0')}`; }
function getCurrentKey() { return getKey(currentYear, currentMonth); }

function getMonthData() {
  if (!data[getCurrentKey()]) data[getCurrentKey()] = { income: [], expense: [] };
  return data[getCurrentKey()];
}

function saveData() { localStorage.setItem('fintrack_data', JSON.stringify(data)); }

function formatRON(n) { return n.toLocaleString('ro-RO', { minimumFractionDigits: 2, maximumFractionDigits: 2 }) + ' RON'; }

function updateHeader() {
  document.getElementById('current-month-label').textContent = `${MONTHS_RO[currentMonth]} ${currentYear}`;
}

function renderLists() {
  const md = getMonthData();
  const incomeList = document.getElementById('income-list');
  const expenseList = document.getElementById('expense-list');

  if (md.income.length === 0) {
    incomeList.innerHTML = '<div class="empty-state">Nicio înregistrare. Apasă + Adaugă.</div>';
  } else {
    incomeList.innerHTML = md.income.map((e, i) => `
      <div class="entry-row">
        <span style="font-size:0.82rem;flex:1;min-width:0;overflow:hidden;text-overflow:ellipsis;white-space:nowrap">${e.desc}</span>
        <span class="tag">${e.cat}</span>
        <span class="entry-amount income-amount">${formatRON(e.amount)}</span>
        <button class="btn-del" onclick="deleteEntry('income',${i})">✕</button>
      </div>`).join('');
  }

  if (md.expense.length === 0) {
    expenseList.innerHTML = '<div class="empty-state">Nicio înregistrare. Apasă + Adaugă.</div>';
  } else {
    expenseList.innerHTML = md.expense.map((e, i) => `
      <div class="entry-row">
        <span style="font-size:0.82rem;flex:1;min-width:0;overflow:hidden;text-overflow:ellipsis;white-space:nowrap">${e.desc}</span>
        <span class="tag">${e.cat}</span>
        <span class="entry-amount expense-amount">${formatRON(e.amount)}</span>
        <button class="btn-del" onclick="deleteEntry('expense',${i})">✕</button>
      </div>`).join('');
  }

  updateSummary(md);
  renderChart();
}

function updateSummary(md) {
  const totalIncome = md.income.reduce((s, e) => s + e.amount, 0);
  const totalExpense = md.expense.reduce((s, e) => s + e.amount, 0);
  const balance = totalIncome - totalExpense;

  document.getElementById('total-income').textContent = formatRON(totalIncome);
  document.getElementById('total-expense').textContent = formatRON(totalExpense);
  document.getElementById('income-count').textContent = `${md.income.length} înregistrări`;
  document.getElementById('expense-count').textContent = `${md.expense.length} înregistrări`;

  const balEl = document.getElementById('total-balance');
  balEl.textContent = formatRON(balance);
  balEl.className = 'card-value balance' + (balance < 0 ? ' negative' : '');

  const pct = totalIncome > 0 ? ((totalExpense / totalIncome) * 100).toFixed(0) : 0;
  document.getElementById('balance-status').textContent =
    totalIncome === 0 ? '—' : (balance >= 0 ? `${pct}% din venituri cheltuite` : `Deficit de ${formatRON(Math.abs(balance))}`);
}

function renderChart() {
  const wrap = document.getElementById('bars-wrap');
  const months = [];
  for (let i = 5; i >= 0; i--) {
    let m = currentMonth - i;
    let y = currentYear;
    while (m < 0) { m += 12; y--; }
    months.push({ m, y, label: MONTHS_RO[m].substring(0,3) });
  }

  const vals = months.map(({ m, y }) => {
    const k = getKey(y, m);
    const d = data[k] || { income: [], expense: [] };
    return {
      income: d.income.reduce((s, e) => s + e.amount, 0),
      expense: d.expense.reduce((s, e) => s + e.amount, 0)
    };
  });

  const maxVal = Math.max(...vals.map(v => Math.max(v.income, v.expense)), 1);

  wrap.innerHTML = months.map(({ label }, i) => {
    const ih = Math.round((vals[i].income / maxVal) * 100);
    const eh = Math.round((vals[i].expense / maxVal) * 100);
    return `
      <div class="bar-group">
        <div class="bar-pair">
          <div class="bar-income" style="height:${ih}%"></div>
          <div class="bar-expense" style="height:${eh}%"></div>
        </div>
        <div class="bar-month-label">${label}</div>
      </div>`;
  }).join('');
}

function openModal(type) {
  modalType = type;
  document.getElementById('modal-title').textContent = type === 'income' ? 'Adaugă Venit' : 'Adaugă Cheltuială';
  document.getElementById('modal-desc').value = '';
  document.getElementById('modal-amount').value = '';

  const catSel = document.getElementById('modal-category');
  if (type === 'income') {
    catSel.innerHTML = ['Salariu','Freelance','Investiții','Chirie primită','Dividende','Altele'].map(c => `<option>${c}</option>`).join('');
  } else {
    catSel.innerHTML = ['Mâncare','Transport','Utilități','Sănătate','Divertisment','Îmbrăcăminte','Chirie','Educație','Tehnologie','Altele'].map(c => `<option>${c}</option>`).join('');
  }

  document.getElementById('modal-overlay').classList.add('open');
  setTimeout(() => document.getElementById('modal-desc').focus(), 50);
}

function closeModal() {
  document.getElementById('modal-overlay').classList.remove('open');
}

function addEntry() {
  const desc = document.getElementById('modal-desc').value.trim();
  const amount = parseFloat(document.getElementById('modal-amount').value);
  const cat = document.getElementById('modal-category').value;

  if (!desc || isNaN(amount) || amount <= 0) {
    document.getElementById('modal-desc').style.borderColor = !desc ? 'var(--accent-red)' : '';
    document.getElementById('modal-amount').style.borderColor = (isNaN(amount) || amount <= 0) ? 'var(--accent-red)' : '';
    return;
  }

  const md = getMonthData();
  md[modalType].push({ desc, amount, cat, date: new Date().toISOString() });
  saveData();
  closeModal();
  renderLists();
}

function deleteEntry(type, index) {
  const md = getMonthData();
  md[type].splice(index, 1);
  saveData();
  renderLists();
}

document.getElementById('prev-month').onclick = () => {
  currentMonth--;
  if (currentMonth < 0) { currentMonth = 11; currentYear--; }
  updateHeader(); renderLists();
};

document.getElementById('next-month').onclick = () => {
  currentMonth++;
  if (currentMonth > 11) { currentMonth = 0; currentYear++; }
  updateHeader(); renderLists();
};

document.getElementById('modal-overlay').addEventListener('click', e => {
  if (e.target === document.getElementById('modal-overlay')) closeModal();
});

document.addEventListener('keydown', e => {
  if (e.key === 'Escape') closeModal();
  if (e.key === 'Enter' && document.getElementById('modal-overlay').classList.contains('open')) addEntry();
});

// ---- PDF Generation ----
function generatePDF() {
  const { jsPDF } = window.jspdf;
  const doc = new jsPDF({ orientation: 'portrait', unit: 'mm', format: 'a4' });

  const md = getMonthData();
  const totalIncome = md.income.reduce((s, e) => s + e.amount, 0);
  const totalExpense = md.expense.reduce((s, e) => s + e.amount, 0);
  const balance = totalIncome - totalExpense;
  const monthLabel = `${MONTHS_RO[currentMonth]} ${currentYear}`;

  const W = 210, margin = 15;

  // Background
  doc.setFillColor(14, 14, 17);
  doc.rect(0, 0, W, 297, 'F');

  // Header bar
  doc.setFillColor(22, 22, 28);
  doc.rect(0, 0, W, 40, 'F');

  // Logo
  doc.setTextColor(232, 232, 240);
  doc.setFont('helvetica', 'bold');
  doc.setFontSize(22);
  doc.text('fin.track', margin, 22);

  // Month label
  doc.setFontSize(10);
  doc.setTextColor(112, 112, 160);
  doc.setFont('helvetica', 'normal');
  doc.text('RAPORT LUNAR', W - margin, 16, { align: 'right' });
  doc.setFontSize(13);
  doc.setTextColor(232, 232, 240);
  doc.text(monthLabel.toUpperCase(), W - margin, 26, { align: 'right' });

  // Generated date
  doc.setFontSize(8);
  doc.setTextColor(64, 64, 96);
  doc.text(`Generat: ${new Date().toLocaleDateString('ro-RO')}`, margin, 35);

  let y = 52;

  // Summary boxes
  const boxW = (W - margin * 2 - 10) / 3;
  const boxes = [
    { label: 'VENITURI TOTALE', value: formatRON(totalIncome), color: [74, 222, 128] },
    { label: 'CHELTUIELI TOTALE', value: formatRON(totalExpense), color: [248, 113, 113] },
    { label: 'BALANȚĂ', value: formatRON(balance), color: balance >= 0 ? [251, 191, 36] : [248, 113, 113] }
  ];

  boxes.forEach((box, i) => {
    const bx = margin + i * (boxW + 5);
    doc.setFillColor(30, 30, 39);
    doc.roundedRect(bx, y, boxW, 26, 3, 3, 'F');
    doc.setFontSize(7);
    doc.setTextColor(112, 112, 160);
    doc.text(box.label, bx + 6, y + 8);
    doc.setFontSize(12);
    doc.setTextColor(...box.color);
    doc.setFont('helvetica', 'bold');
    doc.text(box.value, bx + 6, y + 20);
    doc.setFont('helvetica', 'normal');
  });

  y += 36;

  // Breakdown
  const renderTable = (title, entries, color) => {
    doc.setFontSize(9);
    doc.setTextColor(...color);
    doc.setFont('helvetica', 'bold');
    doc.text(title, margin, y);
    doc.setFont('helvetica', 'normal');
    y += 4;

    if (entries.length === 0) {
      doc.setFontSize(8);
      doc.setTextColor(64, 64, 96);
      doc.text('Nicio înregistrare în această lună.', margin + 4, y + 6);
      y += 14;
      return;
    }

    doc.autoTable({
      startY: y,
      margin: { left: margin, right: margin },
      head: [['Descriere', 'Categorie', 'Sumă (RON)']],
      body: entries.map(e => [e.desc, e.cat, formatRON(e.amount)]),
      foot: [['', 'TOTAL', formatRON(entries.reduce((s, e) => s + e.amount, 0))]],
      theme: 'plain',
      styles: {
        font: 'helvetica',
        fontSize: 8,
        cellPadding: 3,
        textColor: [232, 232, 240],
        fillColor: [22, 22, 28],
        lineColor: [42, 42, 56],
        lineWidth: 0.3
      },
      headStyles: {
        fillColor: [30, 30, 39],
        textColor: [112, 112, 160],
        fontStyle: 'normal',
        fontSize: 7,
      },
      footStyles: {
        fillColor: [30, 30, 39],
        textColor: color,
        fontStyle: 'bold',
        fontSize: 8,
      },
      alternateRowStyles: { fillColor: [19, 19, 25] },
      columnStyles: { 2: { halign: 'right' } }
    });

    y = doc.lastAutoTable.finalY + 8;
  };

  renderTable('VENITURI', md.income, [74, 222, 128]);
  renderTable('CHELTUIELI', md.expense, [248, 113, 113]);

  // Footer
  doc.setFillColor(22, 22, 28);
  doc.rect(0, 285, W, 12, 'F');
  doc.setFontSize(7);
  doc.setTextColor(64, 64, 96);
  doc.text('fin.track — Dashboard Financiar Personal', margin, 292);
  doc.text(`Pagina 1`, W - margin, 292, { align: 'right' });

  doc.save(`fintrack-${MONTHS_RO[currentMonth].toLowerCase()}-${currentYear}.pdf`);
}

// ---- Seed Random Data ----
function seedRandomData() {
  const incomeTemplates = [
    { desc: 'Salariu net', cat: 'Salariu' },
    { desc: 'Bonus trimestrial', cat: 'Salariu' },
    { desc: 'Proiect freelance web', cat: 'Freelance' },
    { desc: 'Consultanță IT', cat: 'Freelance' },
    { desc: 'Design grafic client', cat: 'Freelance' },
    { desc: 'Dividende acțiuni BVB', cat: 'Dividende' },
    { desc: 'Chirie apartament', cat: 'Chirie primită' },
    { desc: 'Vânzare articole online', cat: 'Altele' },
    { desc: 'Rambursare cheltuieli', cat: 'Altele' },
    { desc: 'Premiu concurs', cat: 'Altele' },
  ];

  const expenseTemplates = [
    { desc: 'Cumpărături supermarket', cat: 'Mâncare' },
    { desc: 'Restaurant cu prietenii', cat: 'Mâncare' },
    { desc: 'Abonament transport STB', cat: 'Transport' },
    { desc: 'Carburant mașină', cat: 'Transport' },
    { desc: 'Factura electricitate', cat: 'Utilități' },
    { desc: 'Factura gaz', cat: 'Utilități' },
    { desc: 'Abonament internet', cat: 'Utilități' },
    { desc: 'Consultație medic', cat: 'Sănătate' },
    { desc: 'Farmacie', cat: 'Sănătate' },
    { desc: 'Netflix + Spotify', cat: 'Divertisment' },
    { desc: 'Cinema & ieșiri', cat: 'Divertisment' },
    { desc: 'Haine & încălțăminte', cat: 'Îmbrăcăminte' },
    { desc: 'Chirie lunară', cat: 'Chirie' },
    { desc: 'Curs online Udemy', cat: 'Educație' },
    { desc: 'Abonament cloud storage', cat: 'Tehnologie' },
    { desc: 'Reparații acasă', cat: 'Altele' },
    { desc: 'Cadou ziua de naștere', cat: 'Altele' },
  ];

  const rand = (min, max) => Math.round((Math.random() * (max - min) + min) * 100) / 100;
  const pick = arr => arr[Math.floor(Math.random() * arr.length)];

  // Seed last 6 months including current
  for (let i = 5; i >= 0; i--) {
    let m = currentMonth - i;
    let y = currentYear;
    while (m < 0) { m += 12; y--; }
    const key = getKey(y, m);
    if (data[key]) continue; // don't overwrite existing data

    const monthData = { income: [], expense: [] };

    // 2-4 income entries
    const incomeCount = Math.floor(Math.random() * 3) + 2;
    const usedIncome = new Set();
    for (let j = 0; j < incomeCount; j++) {
      let tpl;
      do { tpl = pick(incomeTemplates); } while (usedIncome.has(tpl.desc));
      usedIncome.add(tpl.desc);
      let amount;
      if (tpl.cat === 'Salariu') amount = rand(4500, 8500);
      else if (tpl.cat === 'Freelance') amount = rand(500, 2500);
      else if (tpl.cat === 'Dividende') amount = rand(200, 900);
      else if (tpl.cat === 'Chirie primită') amount = rand(800, 1500);
      else amount = rand(100, 600);
      monthData.income.push({ desc: tpl.desc, cat: tpl.cat, amount, date: new Date(y, m, rand(1,28)).toISOString() });
    }

    // 5-10 expense entries
    const expenseCount = Math.floor(Math.random() * 6) + 5;
    const usedExpense = new Set();
    for (let j = 0; j < expenseCount; j++) {
      let tpl;
      let tries = 0;
      do { tpl = pick(expenseTemplates); tries++; } while (usedExpense.has(tpl.desc) && tries < 20);
      usedExpense.add(tpl.desc);
      let amount;
      if (tpl.cat === 'Chirie') amount = rand(1200, 2500);
      else if (tpl.cat === 'Mâncare') amount = rand(200, 900);
      else if (tpl.cat === 'Transport') amount = rand(50, 400);
      else if (tpl.cat === 'Utilități') amount = rand(80, 350);
      else if (tpl.cat === 'Sănătate') amount = rand(50, 400);
      else if (tpl.cat === 'Divertisment') amount = rand(30, 300);
      else amount = rand(30, 500);
      monthData.expense.push({ desc: tpl.desc, cat: tpl.cat, amount, date: new Date(y, m, rand(1,28)).toISOString() });
    }

    data[key] = monthData;
  }
  saveData();
}

// Init
seedRandomData();
updateHeader();
renderLists();
</script>
</body>
</html>
